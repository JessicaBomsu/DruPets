<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro Administrador - DruPets</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="auth-page">
    <div class="auth-container">
        <div class="auth-header">
            <div class="logo">
                <span class="paw-print">üêæ</span>
                <h1 class="logo-text">DruPets</h1>
                <span class="paw-print">üêæ</span>
            </div>
            <h2>Cadastro Administrador</h2>
            <p style="color: var(--danger); font-size: 0.9rem; margin-top: 10px;">
                <i class="fas fa-exclamation-triangle"></i> Acesso restrito - Sistema Interno
            </p>
        </div>

        <div class="auth-form">
            <form id="admin-form">
                <div class="form-group">
                    <label for="admin-key">Chave de Seguran√ßa *</label>
                    <input type="password" id="admin-key" required placeholder="Digite a chave de seguran√ßa">
                    <small>Chave necess√°ria para criar contas administrativas</small>
                </div>

                <div class="form-group">
                    <label for="admin-name">Nome Completo *</label>
                    <input type="text" id="admin-name" required placeholder="Nome do administrador">
                </div>

                <div class="form-group">
                    <label for="admin-email">E-mail *</label>
                    <input type="email" id="admin-email" required placeholder="admin@amin.com">
                </div>

                <div class="form-group">
                    <label for="admin-password">Senha *</label>
                    <input type="password" id="admin-password" required placeholder="M√≠nimo 6 caracteres">
                    <small>Use uma senha forte para seguran√ßa do sistema</small>
                </div>

                <div class="form-group">
                    <label for="admin-phone">Telefone</label>
                    <input type="tel" id="admin-phone" class="phone-mask" placeholder="(11) 99999-9999">
                </div>

                <button type="submit" class="btn btn-block">
                    <i class="fas fa-shield-alt"></i> Criar Conta Administrativa
                </button>
            </form>

            <div class="auth-links">
                <a href="index.html">‚Üê Voltar para o site principal</a>
                <a href="login.html">Fazer login em conta existente</a>
            </div>
        </div>
    </div>

    <!-- Loader -->
    <div class="paw-loader" id="pawLoader">
        <div class="paw-spinner">üêæ</div>
        <div class="paw-loader-text">Carregando...</div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script>
        // Configura√ß√£o do Firebase (usa a mesma do seu site)
        const firebaseConfig = {
            apiKey: "AIzaSyBudkk0obhdXCXfx08VvQP90zB5EsOcUAY",
            authDomain: "pex25-a64be.firebaseapp.com",
            databaseURL: "https://pex25-a64be-default-rtdb.firebaseio.com",
            projectId: "pex25-a64be",
            storageBucket: "pex25-a64be.firebasestorage.app",
            messagingSenderId: "524883286653",
            appId: "1:524883286653:web:8e2c8d9028d69e7d996f14",
            measurementId: "G-RE34NV3ZMH"
        };

        // Inicializar Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const database = firebase.database();

        // CHAVE DE ACESSO - MUDE PARA UMA CHAVE SEGURA!
        const ADMIN_ACCESS_KEY = "admin!";

        // Fun√ß√µes de utilit√°rio
        function showPawLoader(text = "Carregando...") {
            const loader = document.getElementById('pawLoader');
            const loaderText = loader.querySelector('.paw-loader-text');
            loaderText.textContent = text;
            loader.classList.add('active');
        }

        function hidePawLoader() {
            const loader = document.getElementById('pawLoader');
            loader.classList.remove('active');
        }

        function showNotification(message, type = 'info') {
            // Criar elemento de notifica√ß√£o
            const notification = document.createElement('div');
            notification.className = `notification ${type} show`;
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(notification);
            
            // Remover ap√≥s 5 segundos
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 5000);
        }

        // Cadastro de administrador
        document.getElementById('admin-form').addEventListener('submit', async function(e) {
            e.preventDefault();

            const accessKey = document.getElementById('admin-key').value;
            const name = document.getElementById('admin-name').value;
            const email = document.getElementById('admin-email').value;
            const password = document.getElementById('admin-password').value;
            const phone = document.getElementById('admin-phone').value;

            // Validar chave de acesso
            if (accessKey !== ADMIN_ACCESS_KEY) {
                showNotification('Chave de seguran√ßa inv√°lida!', 'error');
                return;
            }

            // Valida√ß√µes b√°sicas
            if (!name || !email || !password) {
                showNotification('Por favor, preencha todos os campos obrigat√≥rios.', 'error');
                return;
            }

            if (password.length < 6) {
                showNotification('A senha deve ter no m√≠nimo 6 caracteres.', 'error');
                return;
            }

            showPawLoader("Criando conta administrativa...");

            try {
                // Verificar se o email j√° existe
                const usersSnapshot = await database.ref('cadastro_conta').once('value');
                const users = usersSnapshot.val();
                let emailExists = false;

                if (users) {
                    for (let userId in users) {
                        if (users[userId].email === email) {
                            emailExists = true;
                            break;
                        }
                    }
                }

                if (emailExists) {
                    showNotification('Este e-mail j√° est√° cadastrado no sistema.', 'error');
                    return;
                }

                // Criar conta de administrador
                const adminId = 'admin_' + Date.now();
                const adminData = {
                    nome: name,
                    email: email,
                    senha: password,
                    telefone: phone,
                    tipo: 'admin',
                    data_criacao: new Date().toISOString(),
                    status: 'active',
                    nivel_acesso: 'full',
                    criado_por: 'sistema',
                    ultima_atualizacao: new Date().toISOString()
                };

                await database.ref('cadastro_conta/' + adminId).set(adminData);
                
                showNotification('‚úÖ Conta administrativa criada com sucesso!', 'success');
                
                // Limpar formul√°rio
                this.reset();
                
                console.log('üìã Dados do admin criado:');
                console.log('üë§ Nome:', name);
                console.log('üìß Email:', email);
                console.log('üîë Senha:', password);
                console.log('üÜî ID:', adminId);
                
                // Redirecionar para o painel admin ap√≥s 3 segundos
                setTimeout(() => {
                    window.location.href = 'adm.html';
                }, 3000);

            } catch (error) {
                console.error("Erro ao criar conta admin:", error);
                showNotification('‚ùå Erro ao criar conta: ' + error.message, 'error');
            } finally {
                hidePawLoader();
            }
        });

        // M√°scara de telefone
        document.getElementById('admin-phone').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            
            if (value.length <= 11) {
                if (value.length <= 2) {
                    value = value.replace(/^(\d{0,2})/, '($1');
                } else if (value.length <= 6) {
                    value = value.replace(/^(\d{2})(\d{0,4})/, '($1) $2');
                } else if (value.length <= 10) {
                    value = value.replace(/^(\d{2})(\d{4})(\d{0,4})/, '($1) $2-$3');
                } else {
                    value = value.replace(/^(\d{2})(\d{5})(\d{0,4})/, '($1) $2-$3');
                }
            }
            
            e.target.value = value;
        });

        // Adicionar estilos de notifica√ß√£o
        const style = document.createElement('style');
        style.textContent = `
            .notification {
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                background: white;
                border-radius: 10px;
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
                z-index: 10000;
                display: flex;
                align-items: center;
                gap: 10px;
                transform: translateX(150%);
                transition: transform 0.3s ease;
                max-width: 400px;
                border-left: 4px solid #ccc;
            }
            .notification.show {
                transform: translateX(0);
            }
            .notification.success {
                border-left-color: #4CAF50;
            }
            .notification.error {
                border-left-color: #f44336;
            }
            .notification.info {
                border-left-color: #2196F3;
            }
            .notification i {
                font-size: 1.2rem;
            }
            .notification.success i {
                color: #4CAF50;
            }
            .notification.error i {
                color: #f44336;
            }
            .notification.info i {
                color: #2196F3;
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>